# 회원가입 플로우 정리

## 📋 현재 회원가입 플로우

### 1. 일반 회원가입 플로우

```
Step 1: 약관 동의
  ↓
Step 2: 이름 입력
  ↓
Step 3: 이메일/비밀번호 입력 및 회원가입
  - signIn('credentials') 호출
  - users 테이블에 새 사용자 생성 (is_onboarded: false)
  - Step 4로 이동
  ↓
Step 4: 프로필 사진 및 닉네임 설정
  - 프로필 사진 업로드 (선택)
  - 닉네임 설정 (필수)
  - /onboard로 이동
  ↓
/onboard: 환영 페이지
  - "시작하기" 클릭 시 /expense로 이동
```

### 2. SNS 회원가입 플로우

```
SNS 로그인 (Google/Kakao/Naver)
  ↓
user_map을 통한 public_user 정보 연계
  ↓
is_onboarded 상태 확인
  - false: 프로필 설정 필요
  - true: 홈으로 이동
```

## 🔄 세션 기반 리다이렉트 로직

### 로그인 후 리다이렉트 (`app/page.tsx`)

```typescript
- is_onboarded: true → /home
- is_onboarded: false → /signup?step=4 (프로필 설정)
```

### 전역 세션 리다이렉트 (`component/SessionRedirect.tsx`)

인증된 사용자가 특정 페이지에 접근할 때:
- `is_onboarded: false` → `/signup?step=4`로 리다이렉트
- `is_onboarded: true` → `/home`으로 리다이렉트

**리다이렉트하지 않는 페이지:**
- `/` (로그인 페이지)
- `/signup` (회원가입 페이지)
- `/onboard` (온보딩 페이지)
- `/permissions` (권한 설정 페이지)

## ✅ 개선 사항

### 1. 회원가입 시 is_onboarded 명시적 설정
- **파일**: `app/api/auth/[...nextauth]/route.ts`
- **변경**: 회원가입 시 `is_onboarded: false`를 명시적으로 설정

### 2. 프로필 설정 완료 후 플로우 변경
- **파일**: `app/signup/page.tsx`
- **변경**: 프로필 설정 완료 후 `/permissions` 대신 `/onboard`로 이동

### 3. 세션 기반 리다이렉트 구현
- **파일**: `component/SessionRedirect.tsx` (신규 생성)
- **기능**: 전역적으로 세션 상태에 따라 리다이렉트 처리

## 📝 주요 파일 및 역할

### 인증 관련
- `app/api/auth/[...nextauth]/route.ts`: NextAuth 설정 및 회원가입/로그인 처리
- `providers/session.tsx`: 세션 Provider 및 커스텀 훅

### 회원가입 관련
- `app/signup/page.tsx`: 회원가입 단계별 UI 및 로직
- `app/onboard/page.tsx`: 온보딩 완료 페이지

### 리다이렉트 관련
- `app/page.tsx`: 로그인 페이지의 세션 기반 리다이렉트
- `component/SessionRedirect.tsx`: 전역 세션 리다이렉트 컴포넌트
- `app/layout.tsx`: SessionRedirect 컴포넌트 통합

## 🎯 플로우 체크리스트

- [x] 회원가입 시 is_onboarded를 false로 설정
- [x] 프로필 설정 완료 후 온보딩 페이지로 이동
- [x] 로그인 후 is_onboarded에 따른 리다이렉트
- [x] 전역 세션 리다이렉트 로직 구현
- [x] 프로필 미완성 사용자 자동 리다이렉트

## 🔍 확인 필요 사항

1. **온보딩 완료 처리**: `/onboard` 페이지에서 "시작하기" 클릭 시 `/api/onboard`를 호출하여 `is_onboarded`를 `true`로 업데이트해야 하는지 확인 필요
2. **프로필 설정 완료 여부**: 닉네임과 프로필 사진 설정이 완료되었는지 확인하는 로직 필요 여부 확인
3. **SNS 로그인 플로우**: SNS 로그인 시 프로필 설정이 필요한 경우 처리 방법 확인

